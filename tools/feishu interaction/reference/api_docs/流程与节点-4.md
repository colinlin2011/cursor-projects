节点完成/回滚

该接口用于完成或者回滚一个工作项实例的指定节点（节点流），同时更新节点信息，包括节点负责人、排期和表单信息等。对应的平台功能介绍，如需求实例的节点操作可参考​流转节点和​回滚节点。对应的权限申请在权限管理-工作项实例分类下，相关功能介绍详见 ​权限管理。​

请求说明​

  * 请求方式：POST​



  * 请求地址：/open_api/:project_key/workflow/:work_item_type_key/:work_item_id/node/:node_id/operate​



请求参数​

Header​

接口调用的 Header 配置详见 [Header](../1p8d7djs/4bsmoql6#a8e43b86)。​

Path​

​

参数| 类型| 是否必须| 说明  
---|---|---|---  
project_key| string| 必须| 空间 ID（project_key），或者空间域名（simple_name）。

  * 空间 ID（project_key），在飞书项目空间双击空间名称获取。
  * 空间域名（simple_name），simple_name 一般在飞书项目空间 URL 中获取。例如空间 URL 为 “https://project.feishu.cn/doc/overview”，则 simple_name为 “doc”。

  
work_item_type_key| string| 必须| 工作项类型，系统自动生成，可以从[获取空间下工作项类型](../1p8d7djs/3pjp854w)接口获取。  
work_item_id| string| 必须| 工作项实例 ID，在工作项实例详情中，展开右上角 **··· > ID**获取。  
node_id| string| 必须| 目标节点 ID（节点 ID 或节点 state_key等价），可通过[获取工作流详情](../1p8d7djs/5hcmcl04)接口获取。  
  
​

Body​

​

参数| 类型| 是否必须| 说明  
---|---|---|---  
action| string| 可选| 操作类型，用于指定对节点的操作行为。支持的取值如下所示。

  * confirm：完成节点；
  * rollback：回滚节点。

  
rollback_reason| string| 可选| 当操作类型为 rollback时，必须填写回滚原因，用于说明回滚节点的具体原因。  
node_owners| list<string>| 可选| 节点负责人的用户 user_key数组，用于更新节点的负责人列表。

  * 不传表示无需更新。
  * 传入空数组表示删除所有负责人。

  
node_schedule| object| 可选| 节点的排期，数值结构参见[Schedule](../1p8d7djs/1x1d372l#8b67e4ee)，非必填，若无需更新则为空，适用于**非差异化排期** 场景。  
schedules| list<object>| 可选| 子排期数组，数值结构参见[Schedule](../1p8d7djs/1x1d372l#8b67e4ee)，非必填，若无需更新则为空，适用于**差异化排期** 场景。  
fields| list<object>| 可选| 要更新的字段数组，参见[FieldValuePair](../1p8d7djs/1x1d372l#10c42182)。  
role_assignee| list<object>| 可选| 遵循[RoleOwner](../1p8d7djs/1x1d372l#3209a8ce)结构规范。若节点与角色绑定，可通过role_assignee更新对应角色的负责人  
  
​

返回参数​

​

参数| 类型| 说明  
---|---|---  
err| object| 请求成功时返回空值，请求失败时返回实际错误信息。  
err_msg| string| 请求成功时返回空值，请求失败时返回实际错误信息。  
err_code| int32| 请求成功时0，请求失败返回实际错误码。  
  
​

​

请求示例​

回滚节点并更新节点信息

完成节点并更新节点信息

请求路径：POST /open_api/66f11218c3b4a0b42334xxxx/workflow/story/12592xxxx/node/doing/operate​

​

JSON

复制

{​

"action": "rollback",​

"rollback_reason": "任务回滚",​

"node_schedule": {​

"estimate_start_date": 1722182400000,​

"estimate_end_date": 1722355199999,​

"points": 1​

},​

"role_assignee": [​

{​

"owners": [],​

"role": "PM"​

}​

],​

"fields": [​

{​

"field_alias": "sentry_link",​

"field_key": "field_658c22",​

"field_type_key": "text",​

"field_value": "23333"​

}​

]​

}

​

​

返回示例​

请求成功示例

错误返回示例

​

JSON

复制

{​

"data":{},​

"err": {},​

"err_msg": "",​

"err_code": 0​

}

​

​

错误码​

以下列出了该接口相关的错误码信息，若需查看更多通用错误码说明，参见 [Open API 错误码](../1p8d7djs/5aueo3jr)。​

​

err_code| err_msg| err.code| err.msg| 说明  
---|---|---|---|---  
20017| Node Is Completed| 20017| Node Is Completed| 该节点已经是完成状态，无法执行完成节点操作  
20016| Node Is Not Arrived| 20016| Node Is Not Arrived| 该节点还未开始，无法执行完成节点操作  
20018| Node ID Not Exist In Workflow| 20018| Node ID Not Exist In Workflow| 检查请求中的 node_id 与 work_item_id对应节点在实例中不存在  
20038| Person in charge is required| 20038| Owner Required| 先填写节点负责人，然后再尝试流转节点  
20038| Param missing| 20038| {{节点名}}({{字段ID}}) Required| 先填写给定字段 ID 的字段，然后再尝试流转节点  
20038| Estimates and schedules are required| 20038| {{节点名}} 估分and schedule required| 先填写给定节点的估分与排期，然后再尝试流转节点  
20007| Workitem is abort| 20007| Unable to operate on terminated work items| 检查给定实例状态，实例已经被终止，无法流转其节点  
20038| This role info is mandatory| 20038| role {{角色名}}({{角色ID}}) Required| 先设置错误信息中角色的人员，然后再尝试流转节点  
50006| Param invalid| 50006| {{字段名}}({{字段ID}}) Should Be Passed| 先更新错误信息中字段的信号值，然后再尝试流转节点  
20005| Missing Param | 20005| Missing Param，action || rollBackReason is nil| 调整请求参数，确认action与reason是否正确填写  
50006| task has been finished| 50006| Task has been finished| 确认当前多人完成节点的完成状态，当前登录者确认完成了该节点  
20038| The node actual working time is mandatory| 20038| Node {{节点ID}} 实际工时 is required.| 先填写给定节点的实际工时，然后再尝试流转节点  
30005| WorkItem Not Found| 30005| WorkItem Not Found| 检查给定的实例 ID 是否存在对应实例。  
50006| workflow err| 50006| workflow err| 工作流错误，检查对应实例是否可正常使用。  
20090| Your request has been Intercept| 20090| Your request has been intercepted.| 检查空间中配置的插件拦截规则，当前请求触发的修改命中了插件拦截规则  
50006| Sub Task Not Completed| 50006| Node {{节点名}} cannot be completed because task {{子任务名}} is not completed| 先完成错误信息中的子任务，然后再尝试完成节点  
20050| Field Option Value Is Wrong| 20050| Due to the administrator configuration update| 设置正确的字段值更新值，当前请求中给定的字段选项值已经不可用  
20007| WorkItem Is Already Aborted| 20007| WorkItem Is Already Aborted| 检查入参，给定实例已被终止，不允许进行节点流转  
50006| The current workflow is in transition| 50006| Node workflow transitioning| 已有请求正在对给定节点进行流转，等待2秒以上，确认节点最新状态后再发起请求  
30009| Field Not Found| 30009| field_value_pairs field alias testin_allow:can not find field| 检查请求中更新的字段是否存在  
20038| Required Field Is Not Set| 20038| Milestone due time is required| 先更新节点截止时间，再尝试流转节点  
1000051743| RPC Call Error| 1000051743| Node 估分 must exceed that of its sub-tasks| 检查并设置请求中正确的节点估分，节点估分必须不小于节点下所有子任务的估分总和  
50006| No right to edit| 50006| Unable to edit {{字段名}} ({{字段ID}})| 检查并确认当前登录者是否拥有对应工作项实例的操作权限  
20041| Field RoleOwner Must Be Set In FieldValuePairs| 20041| Role owner do not exist in DB and request| 检查并设置请求中的role_assignee信息，对应角色不存在  
  
​

上一篇

更新节点/排期

下一篇

状态流转
