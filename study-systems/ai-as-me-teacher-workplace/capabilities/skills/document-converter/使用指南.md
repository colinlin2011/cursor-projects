# 文档转换Skill使用指南

## 概述

文档转换Skill是一个通用的Markdown到Word转换能力，可在两个项目中复用：
- `ai-as-me-teacher-workplace`：用于专利申请文档、教学文档转换
- `ai-as-me-workplace`：用于工作文档、项目文档转换

## 快速开始

### 1. 安装依赖

```bash
# 安装Python依赖
pip install -r capabilities/skills/document-converter/requirements.txt

# 安装Pandoc（选择一种方式）
# 方式1：使用包管理器（推荐）
winget install --id JohnMacFarlane.Pandoc

# 方式2：下载安装
# 访问：https://pandoc.org/installing.html
```

### 2. 基本使用

#### Python调用

```python
from capabilities.skills.document_converter import convert_markdown_to_word

# 单个文件转换
result = convert_markdown_to_word(
    source_file="patent/03-权利要求书.md",
    output_file="word-output/权利要求书.docx"
)

if result["success"]:
    print(f"转换成功: {result['output_file']}")
else:
    print(f"转换失败: {result['message']}")
```

#### 命令行调用

```bash
# 单个文件转换
python capabilities/skills/document-converter/converter.py \
    --source patent/03-权利要求书.md \
    --output word-output/权利要求书.docx

# 批量转换
python capabilities/skills/document-converter/converter.py \
    --batch \
    --source-dir patent \
    --output-dir word-output
```

## 使用场景

### 场景1：专利申请文档转换（ai-as-me-teacher-workplace）

```python
from capabilities.skills.document_converter import batch_convert_to_word

# 转换专利申请文档
files = [
    {"source": "patent/03-权利要求书.md", "output": "权利要求书.docx"},
    {"source": "patent/04-说明书.md", "output": "说明书.docx"},
    {"source": "patent/05-说明书摘要.md", "output": "说明书摘要.docx"},
    {"source": "patent/06-附图说明.md", "output": "附图说明.docx"},
]

results = batch_convert_to_word(files, output_dir="patent/word-output")
for result in results:
    print(f"{result['file']}: {result['status']}")
```

### 场景2：工作文档转换（ai-as-me-workplace）

```python
from capabilities.skills.document_converter import convert_markdown_to_word

# 转换工作文档
result = convert_markdown_to_word(
    source_file="work/documents/documents/20260113-safety-plan.md",
    output_file="word-output/safety-plan.docx"
)
```

## 高级功能

### 使用自定义模板

```python
result = convert_markdown_to_word(
    source_file="patent/03-权利要求书.md",
    output_file="word-output/权利要求书.docx",
    template_file="patent/reference.docx"  # 自定义模板
)
```

### 批量转换

```python
from capabilities.skills.document_converter import batch_convert_to_word

files = [
    {"source": "file1.md", "output": "file1.docx"},
    {"source": "file2.md", "output": "file2.docx"},
]

results = batch_convert_to_word(
    files,
    output_dir="word-output",
    template_file="reference.docx"  # 可选模板
)
```

## 错误处理

```python
result = convert_markdown_to_word(
    source_file="document.md",
    output_file="document.docx"
)

if not result["success"]:
    error_code = result.get("error_code")
    if error_code == "PANDOC_NOT_FOUND":
        print("请安装Pandoc")
    elif error_code == "FILE_NOT_FOUND":
        print(f"文件不存在: {result['message']}")
    elif error_code == "CONVERSION_FAILED":
        print(f"转换失败: {result['message']}")
```

## 检查依赖

```python
from capabilities.skills.document_converter import check_dependencies, install_dependencies

# 检查依赖
deps = check_dependencies()
print(f"pypandoc: {deps['pypandoc']}")
print(f"pandoc: {deps['pandoc']}")

# 安装依赖（自动安装pypandoc，pandoc需要手动安装）
results = install_dependencies()
```

## 在两个项目中使用

### ai-as-me-teacher-workplace

```python
# 在教师工作空间中使用
from capabilities.skills.document_converter import convert_markdown_to_word

# 转换专利申请文档
result = convert_markdown_to_word(
    source_file="patent/03-权利要求书.md",
    output_file="patent/word-output/权利要求书.docx"
)
```

### ai-as-me-workplace

```python
# 在工作空间中使用
from capabilities.skills.document_converter import convert_markdown_to_word

# 转换工作文档
result = convert_markdown_to_word(
    source_file="work/documents/documents/20260113-report.md",
    output_file="word-output/report.docx"
)
```

## 注意事项

1. **依赖安装**：确保已安装Pandoc和pypandoc
2. **文件路径**：使用相对路径或绝对路径
3. **模板文件**：模板文件（reference.docx）应放在源文件目录或指定路径
4. **输出目录**：输出目录会自动创建
5. **格式调整**：转换后可能需要手动调整格式

## 更多信息

- 详细文档：[document-converter.md](../document-converter.md)
- 能力注册表：[registry.md](../../registry.md)
- 使用记录：[usage/usage-history.md](../../usage/usage-history.md)
