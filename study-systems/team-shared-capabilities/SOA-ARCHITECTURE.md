# Cursor作业能力SoA架构 - 功能安全视角

**文档版本**：v1.0.0  
**创建日期**：2026-01-20  
**作者**：Colin（功能安全专家）

---

## 为什么用SoA架构来理解？

在自动驾驶域控制器中，我们采用**SoA（Service-Oriented Architecture，面向服务架构）**来组织各种功能模块。同样，在Cursor作业能力系统中，我们也采用类似的架构思想：

- **个人开发的能力** = 就像各个ECU（电子控制单元）提供的功能
- **团队共享的能力库** = 就像服务总线（Service Bus），统一管理和调度
- **业务应用** = 就像整车功能，由多个能力组合实现

这样设计的好处是：**解耦、复用、扩展、治理**。

---

## 用功能安全的实际场景来理解

### 场景1：查询故障信息（实际案例）

**业务需求**：通过问题单号查询故障信息，生成分析报告

**SoA架构视角**：
```
业务需求：查询故障信息
    ↓
服务发现：找到需要的服务（能力）
    ↓
服务编排：组合多个服务
    ├─ 服务1：从飞书项目获取问题单信息（SKILL-001）
    ├─ 服务2：从多维表格查询缺陷数据（SKILL-006）
    └─ 服务3：整合信息并生成报告（SKILL-009）
    ↓
返回结果：故障分析报告
```

**实际代码流程**：
```python
# 1. 服务发现：找到需要的服务
from capabilities.discovery import discover_capabilities
services = discover_capabilities("查询故障信息")

# 2. 服务编排：组合多个服务
workflow = {
    "step1": "fault_ticket_monitor",  # 获取问题单信息
    "step2": "bitable_query",         # 查询多维表格
    "step3": "fault_query"            # 整合分析
}

# 3. 执行工作流
result = execute_workflow(workflow, ticket_id="6683487902")
```

**类比功能安全**：
- 就像设计一个**安全监控机制**，需要组合多个安全功能：
  - 传感器数据采集（对应：获取问题单信息）
  - 数据分析处理（对应：查询多维表格）
  - 安全状态判断（对应：生成分析报告）

---

### 场景2：FMEA数据导入（实际案例）

**业务需求**：将飞书在线表格中的FMEA数据导入到飞书多维表格

**SoA架构视角**：
```
业务需求：FMEA数据导入
    ↓
服务发现：找到FMEA导入服务（SKILL-011）
    ↓
服务调用：直接调用单个服务
    ├─ 读取在线表格数据
    ├─ 数据转换和验证
    ├─ 导入到多维表格
    └─ 生成导入报告
    ↓
返回结果：导入完成报告
```

**实际使用**：
```bash
# 直接调用服务
python import_fmea_complete.py --fmea_name "XX项目FMEA"
```

**类比功能安全**：
- 就像**安全需求分解**，将高层安全需求分解到各个层级：
  - FSC（功能安全概念）→ TSC（技术安全概念）→ 软件/硬件安全需求
  - 在线表格（原始数据）→ 多维表格（结构化数据）

---

### 场景3：飞书多维表格今日更新总结（实际案例）

**业务需求**：每天查看飞书多维表格的更新情况，生成总结

**SoA架构视角**：
```
业务需求：查看今日更新
    ↓
服务发现：找到飞书表格更新服务（SKILL-002）
    ↓
服务调用：调用服务
    ├─ 查询操作记录（通过飞书API）
    ├─ 过滤今日更新
    ├─ 分析更新内容
    └─ 生成总结报告
    ↓
返回结果：今日更新总结
```

**实际使用**：
```python
from feishu_bitable_daily_summary import get_bitable_daily_summary

result = get_bitable_daily_summary(
    table_identifier="表格链接",
    date="2026-01-20"
)
```

**类比功能安全**：
- 就像**安全状态监控**，定期检查系统安全状态：
  - 监控安全需求执行情况
  - 识别安全状态变化
  - 生成安全状态报告

---

## SoA架构层次详解（用功能安全术语）

### L1: 原子服务层（Atomic Service Layer）

**功能安全类比**：就像各个**安全机制（Safety Mechanism）**

每个服务提供单一、独立的功能：

| SoA术语 | 功能安全类比 | 实际例子 |
|---------|------------|---------|
| **Skill服务** | 单一安全机制 | 飞书API封装（SKILL-001） |
| **Agent服务** | 智能安全监控 | 故障诊断Agent |
| **MCP服务** | 外部安全接口 | 飞书API集成（MCP-001） |
| **Tool服务** | 安全工具 | Markdown转Word（SKILL-010） |

**特点**：
- **独立性**：每个服务可以独立开发、测试、使用
- **可复用性**：可以被多个业务场景复用
- **标准化**：统一的接口定义，就像安全需求的标准化格式

**实际案例**：
- **飞书API封装**（SKILL-001）：就像"看门狗监控机制"，提供统一的监控接口
- **文档转换器**（SKILL-010）：就像"数据格式转换机制"，将Markdown转换为Word

---

### L2: 服务提供层（Service Provider Layer）

**功能安全类比**：就像**安全需求分配**，将安全需求分配到不同层级

```
个人层（Personal Layer）
  ↓ 服务贡献（就像安全需求提出）
团队层（Team Layer）
  ↓ 服务聚合（就像安全需求汇总）
组织层（Organization Layer）
  ↓ 服务提供（就像安全需求发布）
```

**个人层**：`ai-as-me-workplace`
- **作用**：个人开发能力的地方
- **类比**：就像你在项目中提出安全需求
- **例子**：你开发了"飞书多维表格今日更新总结"能力

**团队层**：`team-shared-capabilities`
- **作用**：团队共享的能力库
- **类比**：就像团队的安全需求总表，汇总所有人的安全需求
- **例子**：你的能力被注册到团队库，其他人可以使用

**组织层**：（未来扩展）
- **作用**：部门级别的能力库
- **类比**：就像公司的安全标准库，所有项目都可以使用

---

### L3: 服务注册表层（Service Registry Layer）

**功能安全类比**：就像**安全需求总表（Safety Requirements Table）**

在功能安全中，我们有一个"安全需求总表"，记录所有安全需求：
- 需求ID、名称、描述
- ASIL等级、分配层级
- 状态、版本、责任人

在SoA架构中，**服务注册表**就是类似的角色：

| 功能安全 | SoA架构 |
|---------|---------|
| 安全需求总表 | 能力注册表（registry.md） |
| 需求ID | 能力ID（TEAM-SKILL-001） |
| 需求描述 | 能力描述 |
| ASIL等级 | 能力分类（飞书集成/文档处理等） |
| 需求状态 | 能力状态（可用/不可用/维护中） |
| 版本管理 | 能力版本（v1.0.0） |
| 责任人 | 贡献者 |

**实际例子**：
```
能力注册表就像"06. 安全需求总表"多维表格：
- 记录所有能力的基本信息
- 可以快速查找和筛选能力
- 跟踪能力的状态和版本
```

---

### L4: 服务总线层（Service Bus Layer）

**功能安全类比**：就像**安全架构（Safety Architecture）**，负责协调各个安全机制

**服务发现引擎**：
- **作用**：自动找到需要的服务
- **类比**：就像安全架构设计时，选择合适的安全机制
- **例子**：你说"查询故障信息"，系统自动找到相关的服务

**服务匹配器**：
- **作用**：匹配最合适的服务
- **类比**：就像选择最合适的安全机制（看门狗 vs 自检 vs 交叉验证）
- **例子**：根据使用场景，推荐最合适的服务

**服务推荐器**：
- **作用**：基于历史推荐服务组合
- **类比**：就像基于项目经验，推荐安全机制组合方案
- **例子**：之前"查询故障信息"用了哪些服务，下次自动推荐

**路由选择**：
- **作用**：根据规则选择服务
- **类比**：就像根据ASIL等级选择安全机制
- **例子**：高优先级需求 → 使用高可靠性服务

---

### L5: 服务编排层（Service Orchestration Layer）

**功能安全类比**：就像**安全架构设计**，组合多个安全机制实现复杂功能

**工作流引擎**：
- **作用**：编排多个服务，实现复杂业务流程
- **类比**：就像设计安全架构，组合多个安全机制
- **例子**：故障查询工作流 = 获取问题单 + 查询表格 + 生成报告

**业务流程模板**：
- **作用**：预定义的业务流程模板
- **类比**：就像标准的安全架构模板（如冗余监控架构）
- **例子**：故障查询模板、FMEA导入模板

**实际案例**：
```
故障查询工作流（fault_query_workflow）：
1. 获取问题单信息（fault_ticket_monitor）
   ↓
2. 从多维表格查询数据（bitable_query）
   ↓
3. 整合信息并分析（fault_query）
   ↓
4. 生成分析报告

就像设计一个"故障检测与处理"安全架构：
1. 故障检测机制（传感器）
   ↓
2. 故障分析机制（处理器）
   ↓
3. 故障处理机制（执行器）
   ↓
4. 安全状态输出
```

---

### L6: 业务应用层（Application Layer）

**功能安全类比**：就像**整车功能**，最终交付给客户的价值

**项目交付**：
- **平台项目交付**：RHP平台、量产平台等
- **类比**：就像平台级的安全功能
- **使用能力**：文档生成、FMEA分析、安全需求管理等

**算法交付**：
- **感知/规划/控制**：各种算法模块
- **类比**：就像算法级的安全功能
- **使用能力**：算法安全分析、场景库管理等

**CT交付**：
- **PHM/Sensor/cECU**：各种控制器
- **类比**：就像控制器级的安全功能
- **使用能力**：硬件安全分析、诊断功能等

**实际例子**：
```
项目：RHP 1.0功能安全交付
  ├─ 使用能力：FMEA数据导入（SKILL-011）
  ├─ 使用能力：文档转换（SKILL-010）
  ├─ 使用能力：飞书文档协作（SKILL-005）
  └─ 使用能力：故障查询（工作流）

就像RHP 1.0的安全架构：
  ├─ 安全机制1：看门狗监控
  ├─ 安全机制2：自检机制
  ├─ 安全机制3：冗余机制
  └─ 安全机制4：故障处理机制
```

---

## SoA架构的核心价值（用功能安全理解）

### 1. 服务复用 = 安全机制复用

**功能安全场景**：
- 看门狗监控机制可以在多个项目中使用
- 不需要每个项目都重新设计

**SoA架构场景**：
- 飞书API封装可以在多个业务中使用
- 不需要每个业务都重新开发

**实际案例**：
- **飞书API封装**（SKILL-001）被多个业务使用：
  - 故障查询业务
  - FMEA导入业务
  - 文档协作业务
  - 数据同步业务

---

### 2. 服务组合 = 安全架构组合

**功能安全场景**：
- 组合多个安全机制实现复杂安全功能
- 例如：传感器 + 处理器 + 执行器 = 完整的故障处理系统

**SoA架构场景**：
- 组合多个服务实现复杂业务流程
- 例如：获取问题单 + 查询表格 + 生成报告 = 故障查询工作流

**实际案例**：
```
故障查询工作流 = 服务1 + 服务2 + 服务3
就像故障处理系统 = 检测机制 + 分析机制 + 处理机制
```

---

### 3. 服务发现 = 安全需求匹配

**功能安全场景**：
- 根据安全需求，找到合适的安全机制
- 例如：ASIL D需求 → 选择高可靠性安全机制

**SoA架构场景**：
- 根据业务需求，找到合适的服务
- 例如：查询故障信息 → 找到故障查询相关服务

**实际案例**：
```bash
# 服务发现
python discover_capabilities.py --search "故障查询"
# 返回：故障概况提取（SKILL-009）、故障查询工作流等

就像安全需求匹配：
安全需求：故障检测 → 找到：看门狗、自检、交叉验证等机制
```

---

### 4. 服务治理 = 安全需求管理

**功能安全场景**：
- 跟踪安全需求的执行情况
- 分析安全机制的效果
- 优化安全架构设计

**SoA架构场景**：
- 跟踪服务的使用情况
- 分析服务的效果
- 优化服务组合

**实际案例**：
- **使用记录**：记录每个服务的使用次数、使用场景
- **效果分析**：分析服务的成功率、响应时间
- **复利效应**：计算服务带来的累积价值
- **优化建议**：基于数据提出改进建议

---

## 实际工作流程（SoA视角）

### 场景：为XX项目编写FMEA分析报告

**步骤1：业务需求分析**
```
业务需求：编写FMEA分析报告
  ↓
识别需要的服务：
  - 文档生成服务
  - FMEA数据导入服务
  - 文档转换服务
```

**步骤2：服务发现**
```bash
# 查找相关服务
python discover_capabilities.py --scenario "FMEA分析"
# 返回：
# - SKILL-011: FMEA数据导入能力
# - SKILL-010: Markdown转Word文档转换器
# - SKILL-005: 飞书文档协作器
```

**步骤3：服务编排**
```python
# 组合多个服务
workflow = {
    "step1": "import_fmea",      # 导入FMEA数据
    "step2": "generate_report",  # 生成分析报告
    "step3": "convert_to_word"   # 转换为Word格式
}
```

**步骤4：执行工作流**
```bash
# 执行FMEA导入
python import_fmea_complete.py --fmea_name "XX项目FMEA"

# 生成报告（使用文档协作服务）
# 转换为Word（使用文档转换服务）
```

**步骤5：服务监控**
```
记录使用情况：
- 使用了哪些服务
- 使用效果如何
- 是否有改进空间
```

**类比功能安全流程**：
```
1. 安全需求分析：识别需要的安全机制
2. 安全机制选择：选择合适的机制（看门狗、自检等）
3. 安全架构设计：组合多个机制
4. 安全机制实施：实现各个机制
5. 安全验证：验证安全机制效果
```

---

## SoA架构的优势（功能安全视角）

### 1. 解耦（Decoupling）

**功能安全类比**：
- 各个安全机制独立设计，互不影响
- 修改一个安全机制，不影响其他机制

**SoA架构**：
- 各个服务独立开发，互不影响
- 修改一个服务，不影响其他服务

**实际价值**：
- 你可以独立开发"飞书API封装"服务
- 其他人可以独立开发"文档转换"服务
- 两者互不影响，可以并行开发

---

### 2. 复用（Reusability）

**功能安全类比**：
- 看门狗监控机制可以在多个项目中使用
- 不需要每个项目都重新设计

**SoA架构**：
- 飞书API封装可以在多个业务中使用
- 不需要每个业务都重新开发

**实际价值**：
- **飞书API封装**（SKILL-001）被7个不同业务使用
- 节省了重复开发的时间
- 形成了团队复利效应

---

### 3. 扩展（Extensibility）

**功能安全类比**：
- 新增安全机制，不影响现有架构
- 可以逐步完善安全功能

**SoA架构**：
- 新增服务，不影响现有服务
- 可以逐步完善能力库

**实际价值**：
- 团队可以持续贡献新能力
- 能力库不断增长
- 业务能力不断提升

---

### 4. 治理（Governance）

**功能安全类比**：
- 统一管理所有安全需求
- 跟踪安全需求的执行情况
- 持续优化安全架构

**SoA架构**：
- 统一管理所有服务
- 跟踪服务的使用情况
- 持续优化服务组合

**实际价值**：
- 通过使用统计，识别高频使用服务
- 通过效果分析，优化服务质量
- 通过复利效应，量化服务价值

---

## 架构演进路径

### 阶段1：个人能力开发（当前）

**功能安全类比**：就像项目初期，各个模块独立开发安全机制

**SoA架构**：
- 个人在`ai-as-me-workplace`中开发能力
- 能力注册到个人注册表
- 个人使用自己的能力

**例子**：
- 你开发了"飞书API封装"能力
- 注册到个人能力库
- 在自己的工作中使用

---

### 阶段2：团队能力共享（进行中）

**功能安全类比**：就像团队汇总安全需求，形成团队安全需求总表

**SoA架构**：
- 个人能力贡献到团队库
- 团队统一管理和调度
- 团队成员可以复用

**例子**：
- 你的"飞书API封装"能力贡献到团队库
- 其他团队成员可以使用
- 形成团队复利效应

---

### 阶段3：组织能力平台（未来）

**功能安全类比**：就像公司级安全标准库，所有项目都可以使用

**SoA架构**：
- 团队能力汇总到组织级平台
- 跨部门能力共享
- 形成组织级复利效应

**例子**：
- 功能安全部门的能力
- 软件部门的能力
- 硬件部门的能力
- 所有部门都可以使用

---

## 总结：SoA架构 = 功能安全的"安全架构设计"

| SoA架构概念 | 功能安全类比 | 实际价值 |
|------------|------------|---------|
| **服务（Service）** | 安全机制（Safety Mechanism） | 提供独立、可复用的功能 |
| **服务注册表** | 安全需求总表 | 统一管理所有能力 |
| **服务发现** | 安全需求匹配 | 快速找到合适的能力 |
| **服务编排** | 安全架构设计 | 组合多个能力实现复杂功能 |
| **服务治理** | 安全需求管理 | 持续优化能力质量 |
| **业务应用** | 整车功能 | 最终交付的业务价值 |

**核心思想**：
- **个人能力** = 各个ECU的功能
- **团队能力库** = 服务总线，统一管理和调度
- **业务应用** = 整车功能，由多个能力组合实现

**最终目标**：
- 通过SoA架构，实现能力的**解耦、复用、扩展、治理**
- 就像功能安全架构，实现安全机制的**模块化、标准化、可复用、可管理**

---

## 相关文档

- [团队共享库README](README.md)
- [能力注册表](capabilities/registry.md)
- [能力贡献模板](CONTRIBUTION-TEMPLATE.md)
- [使用记录](usage/usage-history.md)

---

**记住**：SoA架构不是技术概念，而是**组织能力的方式**。就像功能安全架构帮助我们组织安全机制一样，SoA架构帮助我们组织作业能力，实现**提效和复利**。
