# 快速添加新多维表格 - 无需重新编写代码！

## ⚠️ 重要提示

**已有通用工具，无需重新编写代码！**

本系统已经提供了完整的多维表格管理能力，包括：
- ✅ 自动缓存和同步
- ✅ 数据查询接口
- ✅ 定时同步服务
- ✅ 多表格支持

**添加新表格只需修改配置，无需编写新脚本！**

---

## 🚀 快速步骤（3步完成）

### 步骤1：获取多维表格信息

从飞书多维表格的URL中获取 `node_token`：

```
https://zyt.feishu.cn/wiki/{node_token}
```

例如：`https://zyt.feishu.cn/wiki/CGMnwhxzLixWhGk87jYcDRfonsh`
- `node_token` = `CGMnwhxzLixWhGk87jYcDRfonsh`

### 步骤2：在配置文件中添加新表格

编辑 `bitable_cache_manager.py`，在 `BITABLE_CONFIGS` 列表中添加新配置：

```python
# 多维表格配置
BITABLE_CONFIGS = [
    {
        "name": "功能安全部人力盘点",
        "node_token": "CGMnwhxzLixWhGk87jYcDRfonsh",
        "url": "https://zyt.feishu.cn/wiki/CGMnwhxzLixWhGk87jYcDRfonsh",
        "cache_file": "hr_inventory.json"
    },
    {
        "name": "新多维表格",
        "node_token": "BPddwBxoRiPFSsk8jZJctCMmndg",
        "url": "https://zyt.feishu.cn/wiki/BPddwBxoRiPFSsk8jZJctCMmndg",
        "cache_file": "new_bitable.json"
    },
    # 👇 只需添加这一条新配置即可！
    {
        "name": "你的新表格名称",                    # 表格显示名称
        "node_token": "你的node_token",              # 从URL中获取
        "url": "https://zyt.feishu.cn/wiki/你的node_token",  # 完整URL
        "cache_file": "new_table.json"              # 缓存文件名（建议用英文）
    }
]
```

**配置说明：**
- `name`: 表格的显示名称（任意，用于识别）
- `node_token`: 从多维表格URL中提取的节点token
- `url`: 多维表格的完整URL（可选，用于文档）
- `cache_file`: 缓存文件名（建议使用英文，避免特殊字符）

### 步骤3：同步数据

运行同步脚本：

```bash
cd "P:\Cursor Project\study-systems\ai-as-me-workplace\capabilities\skills\skills"
python auto_sync_all.py --once
```

或者使用快速同步脚本：

```bash
python sync_cache_now.py
```

---

## ✅ 完成！

现在新表格已经可以使用了：

1. **自动同步**：系统会自动定时同步（默认每小时）
2. **查询接口**：可以使用 `bitable_query_interface.py` 查询数据
3. **AI对话**：在对话中可以直接询问新表格的数据

---

## 📝 示例：添加"项目进度表"

假设你要添加一个名为"项目进度表"的多维表格：

### 1. 获取信息
- URL: `https://zyt.feishu.cn/wiki/AbCdEfGhIjKlMnOpQrStUvWxYz`
- `node_token`: `AbCdEfGhIjKlMnOpQrStUvWxYz`

### 2. 添加配置

```python
BITABLE_CONFIGS = [
    # ... 现有配置 ...
    {
        "name": "项目进度表",
        "node_token": "AbCdEfGhIjKlMnOpQrStUvWxYz",
        "url": "https://zyt.feishu.cn/wiki/AbCdEfGhIjKlMnOpQrStUvWxYz",
        "cache_file": "project_progress.json"
    }
]
```

### 3. 同步

```bash
python auto_sync_all.py --once
```

### 4. 使用

```python
from bitable_query_interface import get_query_interface

interface = get_query_interface()
# 查询项目进度表的数据
data = interface.get_table_data("项目进度表", cache_file="project_progress.json")
```

---

## 🔧 常见问题

### Q: 如何确认 node_token 是否正确？

A: 运行以下脚本验证：

```bash
python get_all_tables.py
```

如果能看到表格列表，说明配置正确。

### Q: 缓存文件保存在哪里？

A: `work/bitable_cache/` 目录下，文件名对应 `cache_file` 配置。

### Q: 如何强制刷新缓存？

A: 运行同步时添加 `--force` 参数：

```bash
python auto_sync_all.py --once --force
```

### Q: 如何查看已配置的表格？

A: 查看 `bitable_cache_manager.py` 中的 `BITABLE_CONFIGS` 列表。

---

## 🎯 关键文件位置

- **配置文件**: `bitable_cache_manager.py` (第40-53行)
- **同步脚本**: `auto_sync_all.py` 或 `sync_cache_now.py`
- **查询接口**: `bitable_query_interface.py`
- **缓存目录**: `work/bitable_cache/`

---

## 💡 提示

1. **不要重新编写代码**：所有功能都已实现，只需添加配置
2. **使用现有工具**：优先使用 `auto_sync_all.py` 而不是创建新脚本
3. **参考现有配置**：复制现有配置项，修改相应字段即可
4. **命名规范**：`cache_file` 建议使用英文，避免中文和特殊字符

---

## 📚 相关文档

- [多维表格缓存系统使用指南](./BITABLE-CACHE-GUIDE.md)
- [多维表格缓存系统总结](./BITABLE-CACHE-SUMMARY.md)
- [自动同步使用说明](./自动同步使用说明.md)
