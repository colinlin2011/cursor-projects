# 飞书文档与Markdown同步工作流程

## 概述

为了提高文档协作效率，我们建立了本地Markdown编辑 + 飞书文档同步的工作流程。你可以在本地Markdown文件中快速编辑，然后一键同步到飞书文档。

## 工作流程

```
本地Markdown编辑 → 运行同步脚本 → 飞书文档更新
```

## 文件位置

- **本地Markdown文件**：`work/fsc-doc/舱驾一体域控的FSC文档.md`
- **同步脚本**：`capabilities/skills/skills/sync_md_to_feishu.py`
- **飞书文档节点**：`DrFAwvNyAi21cJkQj11cUdRZnPh`

## 使用方法

### 1. 编辑本地Markdown文件

直接在本地Markdown文件中编辑内容，支持：

- **标题**：`# 标题1`、`## 标题2`、`### 标题3`、`#### 标题4`
- **文本**：普通段落文本
- **列表**：`- 列表项`（无序列表）
- **粗体**：`**粗体文本**`（会转换为普通文本）

### 2. 同步到飞书文档

运行同步脚本：

```bash
python sync_md_to_feishu.py
```

脚本会：
1. 读取本地Markdown文件
2. 解析Markdown内容为飞书文档块
3. 清空飞书文档现有内容（可选）
4. 将Markdown内容添加到飞书文档

### 3. 查看结果

同步完成后，在飞书中打开文档查看更新后的内容。

## 支持的Markdown元素

| Markdown | 飞书文档块 | 说明 |
|----------|-----------|------|
| `# 标题` | 标题1 | 一级标题 |
| `## 标题` | 标题2 | 二级标题 |
| `### 标题` | 标题3 | 三级标题 |
| `#### 标题` | 标题4 | 四级标题 |
| 普通文本 | 文本块 | 段落文本 |
| `- 列表项` | 无序列表 | 列表项 |
| `**粗体**` | 文本块 | 粗体标记会被移除，保留文本 |

## 注意事项

1. **清空现有内容**：默认会清空飞书文档现有内容，然后添加Markdown内容
2. **格式限制**：复杂格式（表格、代码块、链接等）可能无法完美转换
3. **频率限制**：同步大量内容时，脚本会自动控制请求频率
4. **备份建议**：重要内容建议先在本地Markdown中保存

## 高级用法

### 只同步部分内容

可以修改脚本，只同步Markdown文件的特定部分：

```python
# 在sync_md_to_feishu函数中，可以添加内容过滤
blocks = parse_markdown_to_blocks(md_content)
# 只同步特定章节
filtered_blocks = [b for b in blocks if "特定章节" in str(b)]
```

### 增量同步

可以修改脚本，实现增量同步（只添加新内容，不删除旧内容）：

```python
# 设置clear_first=False
sync_md_to_feishu(md_file_path, api, document_id, clear_first=False)
```

## 故障排除

### 问题1：同步失败

- 检查`USER_ACCESS_TOKEN`是否有效
- 检查文档节点token是否正确
- 检查Markdown文件路径是否正确

### 问题2：格式不正确

- 检查Markdown语法是否正确
- 复杂格式可能需要手动调整

### 问题3：内容重复

- 确保`clear_first=True`，先清空再添加
- 或者手动删除飞书文档中的重复内容

## 未来改进

- [ ] 支持双向同步（从飞书读取到Markdown）
- [ ] 支持更多Markdown元素（表格、代码块、链接等）
- [ ] 支持增量更新（只更新变化的部分）
- [ ] 支持冲突检测和解决
