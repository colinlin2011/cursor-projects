# 同步"功能安全业务数据"多维表格缓存说明

## 当前状态

访问令牌已过期，需要更新后才能同步缓存。

## 快速同步步骤

### 步骤1：更新访问令牌

访问令牌已过期，需要获取新的访问令牌。有两种方式：

#### 方式1：使用现有脚本获取（推荐）

运行以下脚本获取新的访问令牌：

```powershell
cd "d:\Users\colin.lin\.cursor\cursor-projects\study-systems\ai-as-me-workplace\capabilities\skills\skills"
python get_user_token_for_bitable.py
```

按照脚本提示完成授权，获取新的访问令牌。

#### 方式2：手动获取

1. 访问飞书开放平台：https://open.feishu.cn/app/cli_a9c92ca516f99bd9/security
2. 配置重定向URL（如果还没配置）：`https://open.feishu.cn/app/cli_a9c92ca516f99bd9/auth`
3. 访问授权URL获取code：
   ```
   https://open.feishu.cn/open-apis/authen/v1/authorize?app_id=cli_a9c92ca516f99bd9&redirect_uri=https://open.feishu.cn/app/cli_a9c92ca516f99bd9/auth&response_type=code&scope=wiki:wiki%20wiki:node:read%20bitable:app%20bitable:app:readonly
   ```
4. 使用code获取访问令牌（参考 `get_token_from_code.py`）

### 步骤2：设置环境变量

获取到新的访问令牌后，设置环境变量：

**PowerShell:**
```powershell
$env:FEISHU_USER_ACCESS_TOKEN="your_new_token_here"
```

**CMD:**
```cmd
set FEISHU_USER_ACCESS_TOKEN=your_new_token_here
```

### 步骤3：同步缓存

运行同步脚本：

```powershell
cd "d:\Users\colin.lin\.cursor\cursor-projects\study-systems\ai-as-me-workplace\capabilities\skills\skills"
python sync_functional_safety_bitable.py
```

脚本会：
1. 强制刷新"功能安全业务数据"多维表格的缓存
2. 检查"缺陷问题闭环表"的记录数
3. 验证记录数是否为253条

## 验证记录数

同步完成后，可以运行以下脚本验证记录数：

```powershell
python check_cache_records.py
```

或者：

```powershell
python query_defect_table.py
```

## 相关文件

- `sync_functional_safety_bitable.py` - 同步脚本（强制刷新）
- `check_cache_records.py` - 检查缓存中的记录数
- `query_defect_table.py` - 查询缺陷问题闭环表
- `get_user_token_for_bitable.py` - 获取访问令牌

## 注意事项

1. 访问令牌有效期约2小时，过期后需要重新获取
2. 如果记录数不是253条，可能是多维表格中的数据已更新
3. 缓存文件位置：`work/bitable_cache/new_bitable.json`
