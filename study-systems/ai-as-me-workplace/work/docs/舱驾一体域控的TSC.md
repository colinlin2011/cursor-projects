# 舱驾一体域控的TSC

## 1. 概述

本文档描述舱驾一体域控制器的技术安全概念（Technical Safety Concept, TSC）。TSC是在功能安全概念（FSC）的基础上，进一步细化到技术层面的安全实现方案，包括硬件和软件的技术安全措施。

### 1.1 文档目的

TSC文档的目的是：

- 将功能安全概念转化为具体的技术实现方案
- 定义硬件和软件层面的技术安全措施
- 确保技术实现能够满足功能安全要求
- 为后续的硬件和软件开发提供技术指导

### 1.2 文档范围

本文档涵盖以下内容：

- 系统技术架构
- 硬件技术安全措施
- 软件技术安全措施
- 技术安全机制
- 技术安全需求
- 技术实现方案

### 1.3 相关文档

- 功能安全概念（FSC）文档
- 系统需求规格说明（SRS）
- 硬件设计文档
- 软件设计文档

## 2. 系统技术架构

### 2.1 硬件架构

#### 2.1.1 计算平台架构

系统采用双SoC架构，实现座舱域和驾驶域的物理隔离：

- **座舱域SoC**：负责信息娱乐、人机交互等功能
  - 处理器：高性能多核CPU + GPU
  - 内存：LPDDR5，容量≥16GB
  - 存储：eUFS 3.1，容量≥256GB
  
- **驾驶域SoC**：负责自动驾驶、车辆控制等功能
  - 处理器：高性能多核CPU + AI加速器
  - 内存：LPDDR5，容量≥32GB
  - 存储：eUFS 3.1，容量≥512GB

#### 2.1.2 通信架构

- **域间通信**：PCIe 4.0高速总线，带宽≥32Gbps
- **外部通信**：CAN-FD、以太网、5G/V2X
- **内部通信**：SPI、I2C、UART等

#### 2.1.3 电源架构

- **主电源**：12V/48V双路输入
- **电源管理**：独立PMIC，支持多路电源轨管理
- **电源监控**：实时监控各电源轨电压、电流

### 2.2 软件架构

#### 2.2.1 操作系统

- **座舱域**：基于Linux的实时操作系统
- **驾驶域**：基于QNX的实时操作系统（ASIL-D认证）

#### 2.2.2 软件分层架构

```
应用层
  ├── 座舱应用（IVI、HMI等）
  └── 驾驶应用（感知、规划、控制等）
中间件层
  ├── 通信中间件（DDS、SOME/IP等）
  ├── 安全监控中间件
  └── 资源管理中间件
操作系统层
  ├── 实时内核
  ├── 驱动层
  └── 硬件抽象层
硬件层
```

#### 2.2.3 虚拟化架构

- **Type-1 Hypervisor**：实现域间逻辑隔离
- **容器技术**：应用层隔离和资源管理

## 3. 硬件技术安全措施

### 3.1 冗余设计

#### 3.1.1 计算冗余

对于ASIL-D关键功能，采用以下冗余策略：

- **主备冗余**：关键算法在主备SoC上并行运行
- **结果交叉验证**：主备结果必须一致才输出
- **故障切换**：主计算单元故障时自动切换到备用单元

#### 3.1.2 传感器冗余

- **多传感器融合**：摄像头、雷达、激光雷达等多传感器数据融合
- **传感器交叉验证**：不同传感器数据相互验证
- **传感器故障检测**：实时检测传感器故障并切换

#### 3.1.3 执行器冗余

- **双通道输出**：关键控制指令通过双通道输出
- **执行器监控**：实时监控执行器状态
- **故障降级**：执行器故障时进入降级模式

### 3.2 看门狗机制

#### 3.2.1 硬件看门狗

- **独立看门狗芯片**：MAX6369或等效芯片
- **超时时间**：可配置，默认500ms
- **复位机制**：超时后触发系统复位

#### 3.2.2 软件看门狗

- **多级看门狗**：应用层、中间件层、驱动层分别设置看门狗
- **喂狗机制**：关键任务定期喂狗
- **超时处理**：超时未喂狗触发安全响应

### 3.3 电源监控

#### 3.3.1 电压监控

- **监控范围**：所有关键电源轨（1.0V, 1.8V, 3.3V, 5V, 12V等）
- **监控精度**：±2%
- **告警阈值**：过压+10%，欠压-10%

#### 3.3.2 电流监控

- **功耗监控**：实时监控系统功耗
- **过流保护**：检测到过流时触发保护机制
- **功耗限制**：动态功耗管理，防止过热

#### 3.3.3 温度监控

- **温度传感器**：多个温度传感器分布在不同位置
- **温度阈值**：工作温度-40°C~+85°C，告警温度>80°C
- **热保护**：温度过高时降频或关机

### 3.4 故障注入和检测

#### 3.4.1 硬件自检

- **启动自检**：系统启动时执行全面的硬件自检
  - CPU自检：运行自检程序，验证CPU功能
  - 内存自检：内存读写测试，检测内存故障
  - 存储自检：存储读写测试，检测存储故障
  - 通信自检：通信接口测试，检测通信故障

- **周期性自检**：运行中定期执行自检
  - 周期：100ms
  - 内容：关键硬件功能验证

#### 3.4.2 故障注入测试

- **硬件故障注入**：通过硬件故障注入接口模拟故障
- **软件故障注入**：通过软件接口模拟软件故障
- **故障响应验证**：验证系统对故障的正确响应

## 4. 软件技术安全措施

### 4.1 运行时监控

#### 4.1.1 任务监控

- **执行时间监控**：监控关键任务的执行时间
  - 超时阈值：任务执行时间不得超过预期时间的150%
  - 超时处理：超时触发告警或安全响应

- **执行结果监控**：监控任务执行结果的合理性
  - 结果范围检查：检查结果是否在合理范围内
  - 结果一致性检查：检查冗余任务结果的一致性

#### 4.1.2 资源监控

- **CPU使用率监控**：
  - 监控周期：100ms
  - 告警阈值：单核使用率>90%，系统使用率>80%
  - 超限处理：触发资源调度或降级策略

- **内存使用监控**：
  - 监控周期：1s
  - 告警阈值：内存使用率>85%
  - 超限处理：触发内存回收或降级策略

- **存储使用监控**：
  - 监控周期：10s
  - 告警阈值：存储使用率>90%
  - 超限处理：触发存储清理或告警

#### 4.1.3 数据监控

- **数据有效性检查**：
  - 范围检查：检查数据是否在允许范围内
  - 合理性检查：检查数据是否符合物理规律
  - 时效性检查：检查数据是否过期

- **数据一致性检查**：
  - 冗余数据一致性：检查冗余通道数据是否一致
  - 数据关联性检查：检查相关数据之间的关联性

### 4.2 数据校验

#### 4.2.1 CRC校验

- **校验算法**：CRC32
- **应用范围**：所有域间和外部通信数据
- **校验失败处理**：丢弃数据，记录错误，触发重传

#### 4.2.2 合理性检查

- **传感器数据合理性**：
  - 物理范围检查：检查数据是否在物理可能范围内
  - 变化率检查：检查数据变化率是否合理
  - 相关性检查：检查不同传感器数据之间的相关性

- **计算结果合理性**：
  - 结果范围检查：检查计算结果是否在合理范围内
  - 结果一致性检查：检查冗余计算结果的一致性

#### 4.2.3 范围检查

- **输入数据范围检查**：所有输入数据必须通过范围检查
- **中间结果范围检查**：关键中间结果进行范围检查
- **输出数据范围检查**：所有输出数据必须通过范围检查

### 4.3 状态机保护

#### 4.3.1 状态转换检查

- **合法转换表**：定义所有合法的状态转换
- **转换检查**：每次状态转换前检查是否合法
- **非法转换处理**：检测到非法转换时进入安全状态

#### 4.3.2 状态一致性

- **状态同步**：确保状态机状态与实际系统状态一致
- **状态验证**：定期验证状态一致性
- **不一致处理**：检测到不一致时进行状态恢复

#### 4.3.3 异常状态处理

- **异常状态检测**：检测系统是否进入异常状态
- **异常状态恢复**：尝试从异常状态恢复到正常状态
- **无法恢复处理**：无法恢复时进入安全状态

### 4.4 错误处理

#### 4.4.1 错误检测

- **异常检测**：通过多种机制检测异常
  - 返回值检查：检查函数返回值
  - 异常捕获：捕获和处理异常
  - 断言检查：关键位置设置断言

#### 4.4.2 错误分类

- **错误等级**：
  - 致命错误：导致系统无法继续运行
  - 严重错误：影响关键功能
  - 一般错误：影响非关键功能
  - 警告：不影响功能但需要关注

#### 4.4.3 错误处理策略

- **致命错误**：立即进入安全状态
- **严重错误**：尝试恢复，失败后进入安全状态
- **一般错误**：记录错误，继续运行
- **警告**：记录警告，继续运行

## 5. 技术安全机制

### 5.1 域隔离机制

#### 5.1.1 物理隔离

- **独立SoC**：座舱域和驾驶域使用独立的SoC
- **独立内存**：每个域使用独立的内存空间
- **独立存储**：每个域使用独立的存储空间

#### 5.1.2 逻辑隔离

- **Hypervisor隔离**：通过Type-1 Hypervisor实现域间隔离
- **容器隔离**：应用层通过容器技术实现隔离
- **访问控制**：严格的访问控制，防止域间非法访问

#### 5.1.3 资源隔离

- **CPU资源隔离**：每个域分配独立的CPU核心
- **内存资源隔离**：每个域分配独立的内存空间
- **I/O资源隔离**：每个域分配独立的I/O资源

### 5.2 通信安全机制

#### 5.2.1 数据完整性保护

- **CRC校验**：所有通信数据添加CRC校验码
- **序列号**：数据包添加序列号，检测丢包和乱序
- **时间戳**：数据包添加时间戳，检测延迟和过期

#### 5.2.2 通信监控

- **通信质量监控**：监控通信延迟、丢包率等
- **通信故障检测**：检测通信链路故障
- **通信恢复**：通信故障时尝试恢复或切换备用通道

#### 5.2.3 访问控制

- **身份认证**：通信双方进行身份认证
- **权限控制**：根据权限控制数据访问
- **审计日志**：记录所有通信访问日志

### 5.3 故障检测和诊断

#### 5.3.1 故障检测机制

- **硬件故障检测**：
  - 看门狗超时检测
  - 电源异常检测
  - 温度异常检测
  - 通信故障检测

- **软件故障检测**：
  - 任务超时检测
  - 资源耗尽检测
  - 数据异常检测
  - 状态异常检测

#### 5.3.2 故障诊断

- **故障分类**：根据故障特征进行分类
- **故障定位**：确定故障发生的具体位置
- **故障分析**：分析故障原因和影响范围

#### 5.3.3 故障记录

- **故障日志**：记录所有故障信息
  - 故障类型
  - 故障时间
  - 故障位置
  - 故障原因
  - 故障影响

- **事件日志**：记录系统事件
  - 状态变化
  - 操作事件
  - 告警事件

## 6. 技术安全需求

### 6.1 硬件技术安全需求

#### HW-TSR-1: 硬件应实现双SoC架构

**ASIL等级**：ASIL-D

**需求描述**：

- 座舱域和驾驶域应使用独立的SoC，确保物理隔离
- 每个SoC应具备独立的计算、内存、存储资源
- SoC之间应通过专用高速总线通信

#### HW-TSR-2: 硬件应提供独立的看门狗电路

**ASIL等级**：ASIL-D

**需求描述**：

- 系统应配置独立的硬件看门狗芯片
- 看门狗超时时间应可配置，范围：100ms~2000ms
- 看门狗超时应触发系统复位或进入安全状态

#### HW-TSR-3: 硬件应提供电源监控电路

**ASIL等级**：ASIL-C

**需求描述**：

- 系统应配置电源监控电路，监控所有关键电源轨
- 监控精度应≤±2%
- 检测到过压、欠压等异常时应触发告警

#### HW-TSR-4: 硬件应支持冗余设计

**ASIL等级**：ASIL-D

**需求描述**：

- 关键功能应支持硬件冗余
- 冗余通道应独立运行，互不干扰
- 冗余结果应进行交叉验证

### 6.2 软件技术安全需求

#### SW-TSR-1: 软件应实现运行时监控

**ASIL等级**：ASIL-D

**需求描述**：

- 软件应实时监控关键任务的执行状态
- 监控周期应≤100ms
- 检测到异常时应触发安全响应

#### SW-TSR-2: 软件应实现数据校验

**ASIL等级**：ASIL-C

**需求描述**：

- 所有域间通信数据应进行CRC校验
- 关键数据应进行合理性检查
- 校验失败时应丢弃数据并记录错误

#### SW-TSR-3: 软件应实现看门狗喂狗机制

**ASIL等级**：ASIL-D

**需求描述**：

- 关键任务应定期喂狗
- 喂狗周期应≤500ms
- 超时未喂狗应触发系统复位或进入安全状态

#### SW-TSR-4: 软件应实现资源监控和限制

**ASIL等级**：ASIL-C

**需求描述**：

- 软件应监控CPU、内存等资源使用情况
- 资源使用超过阈值时应触发告警或降级策略
- 应防止资源耗尽导致系统故障

#### SW-TSR-5: 软件应实现状态机保护

**ASIL等级**：ASIL-C

**需求描述**：

- 关键功能应使用状态机管理
- 状态转换应进行合法性检查
- 检测到非法状态转换时应进入安全状态

### 6.3 通信技术安全需求

#### COM-TSR-1: 通信应实现数据完整性保护

**ASIL等级**：ASIL-C

**需求描述**：

- 所有通信数据应添加CRC校验码
- 数据包应包含序列号和时间戳
- 接收方应验证数据完整性

#### COM-TSR-2: 通信应实现超时检测

**ASIL等级**：ASIL-C

**需求描述**：

- 关键通信应设置超时检测
- 超时时间应根据通信类型设置
- 超时应触发错误处理

#### COM-TSR-3: 通信应实现访问控制

**ASIL等级**：ASIL-B

**需求描述**：

- 通信双方应进行身份认证
- 应根据权限控制数据访问
- 应记录所有通信访问日志

## 7. 技术实现方案

### 7.1 硬件实现方案

#### 7.1.1 SoC选型

- **座舱域SoC**：Qualcomm SA8295P或等效芯片
  - CPU：8核Kryo 685，主频≥2.5GHz
  - GPU：Adreno 690，算力≥3TFLOPS
  - AI加速器：Hexagon DSP，算力≥30TOPS

- **驾驶域SoC**：NVIDIA Orin或等效芯片
  - CPU：12核ARM Cortex-A78AE，主频≥2.0GHz
  - GPU：NVIDIA Ampere架构，算力≥200TOPS
  - AI加速器：DLA，算力≥200TOPS

#### 7.1.2 看门狗实现

- **硬件看门狗芯片**：MAX6369或等效
- **连接方式**：通过I2C接口连接
- **复位方式**：硬件复位引脚

#### 7.1.3 电源监控实现

- **电源监控芯片**：MAX14921或等效
- **监控通道**：支持多路电压/电流监控
- **接口方式**：I2C接口

### 7.2 软件实现方案

#### 7.2.1 监控模块实现

- **任务监控**：基于RTOS任务管理接口
- **资源监控**：基于系统调用接口
- **数据监控**：基于数据校验库

#### 7.2.2 校验模块实现

- **CRC校验**：使用标准CRC32算法
- **合理性检查**：基于规则引擎
- **范围检查**：基于配置的上下限

#### 7.2.3 状态机实现

- **状态机框架**：基于状态机设计模式
- **状态转换表**：配置文件定义
- **状态验证**：运行时验证

### 7.3 通信实现方案

#### 7.3.1 域间通信实现

- **通信协议**：基于PCIe 4.0
- **数据格式**：自定义协议，包含CRC、序列号、时间戳
- **错误处理**：自动重传机制

#### 7.3.2 外部通信实现

- **CAN通信**：基于CAN-FD协议
- **以太网通信**：基于TCP/IP协议
- **5G/V2X通信**：基于5G NR协议

## 8. 验证和确认

### 8.1 技术安全需求验证

#### 8.1.1 需求评审

- **评审内容**：技术安全需求的完整性、正确性、可追溯性
- **评审方法**：同行评审、专家评审
- **评审标准**：ISO 26262标准要求

#### 8.1.2 设计验证

- **设计评审**：硬件和软件设计评审
- **仿真验证**：通过仿真验证设计正确性
- **原型验证**：通过原型验证设计可行性

#### 8.1.3 测试验证

- **单元测试**：验证单个模块的正确性
- **集成测试**：验证模块集成的正确性
- **系统测试**：验证系统功能的正确性
- **安全测试**：验证安全机制的有效性

### 8.2 技术安全机制验证

#### 8.2.1 功能测试

- **正常功能测试**：验证系统正常功能
- **异常功能测试**：验证系统异常处理
- **边界测试**：验证系统边界条件

#### 8.2.2 故障注入测试

- **硬件故障注入**：注入硬件故障，验证系统响应
- **软件故障注入**：注入软件故障，验证系统响应
- **通信故障注入**：注入通信故障，验证系统响应

#### 8.2.3 性能测试

- **响应时间测试**：验证系统响应时间
- **资源使用测试**：验证资源使用情况
- **并发测试**：验证系统并发处理能力

### 8.3 安全分析

#### 8.3.1 FTA分析

- **故障树分析**：分析系统故障模式
- **故障传播分析**：分析故障传播路径
- **故障影响分析**：分析故障影响范围

#### 8.3.2 FMEA分析

- **故障模式分析**：分析可能的故障模式
- **故障影响分析**：分析故障对系统的影响
- **故障检测分析**：分析故障检测能力

#### 8.3.3 安全评估

- **安全完整性评估**：评估安全机制的完整性
- **安全有效性评估**：评估安全机制的有效性
- **安全可靠性评估**：评估安全机制的可靠性

## 9. 配置管理

### 9.1 版本管理

- **文档版本**：TSC文档版本管理
- **需求版本**：技术安全需求版本管理
- **设计版本**：技术设计版本管理

### 9.2 变更管理

- **变更流程**：技术安全需求变更流程
- **影响分析**：变更影响分析
- **变更验证**：变更后验证

### 9.3 追溯性

- **需求追溯**：技术安全需求到功能安全需求的追溯
- **设计追溯**：技术设计到技术安全需求的追溯
- **测试追溯**：测试用例到技术安全需求的追溯

## 10. 总结

本文档详细描述了舱驾一体域控制器的技术安全概念，包括：

- 系统技术架构设计
- 硬件和软件技术安全措施
- 技术安全机制实现
- 技术安全需求定义
- 技术实现方案
- 验证和确认方法

通过实施这些技术安全措施，确保系统能够满足ISO 26262 ASIL-D等级的功能安全要求，实现安全可靠的智能驾驶功能。
