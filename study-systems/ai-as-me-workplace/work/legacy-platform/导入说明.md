# 历史工作平台数据导入说明

## 当前状态

已创建导入脚本 `import_legacy_bitable.py`，但遇到以下问题：

### 问题分析

1. **API调用成功**：使用 `tenant_access_token` 可以成功获取多维表格信息（"Colin个人工作平台"）
2. **数据表列表为空**：API返回 `{"items": []}`，表示数据表列表为空
3. **user_access_token过期**：尝试使用 `user_access_token` 时提示token已过期

### 可能原因

1. **权限问题**：`tenant_access_token` 可能没有读取数据表的权限，需要使用 `user_access_token`
2. **数据表确实为空**：表格中可能没有创建数据表（不太可能）
3. **需要用户授权**：某些多维表格需要用户授权才能访问数据表

## 解决方案

### 方案1：重新获取user_access_token（推荐）

1. **获取授权URL**：
   ```python
   # 运行以下脚本获取授权URL
   python get_user_token_for_bitable.py
   ```

2. **访问授权URL**：在浏览器中打开返回的URL，完成授权

3. **获取code**：授权后会重定向到回调URL，从URL中提取 `code` 参数

4. **获取user_access_token**：使用code获取token

5. **更新环境变量**：
   ```powershell
   $env:FEISHU_USER_ACCESS_TOKEN = "your_user_access_token"
   ```

6. **重新运行导入脚本**：
   ```powershell
   python import_legacy_bitable.py
   ```

### 方案2：检查应用权限配置

确保飞书开放平台应用具有以下权限：
- `bitable:app:readonly` - 查看、评论和导出多维表格
- `bitable:app` - 查看、评论、编辑和管理多维表格

### 方案3：手动导出数据

如果API方式无法解决，可以：
1. 在飞书多维表格中手动导出数据
2. 将导出的数据整理后，按照工作框架手动创建记录

## 脚本位置

- **导入脚本**：`capabilities/skills/skills/import_legacy_bitable.py`
- **输出目录**：`work/legacy-platform/`
  - `tables/` - 数据表导出文件
  - `import-summary.md` - 导入总结报告

## 下一步

1. 重新获取 `user_access_token`
2. 更新环境变量
3. 重新运行导入脚本
4. 检查导入结果并整理到工作框架

## 参考文档

- 飞书开放平台API文档：`tools/feishu interaction/reference/api_docs/`
- 多维表格API：`api_docs/多维表格-获取记录列表.md`
- 获取用户token：`capabilities/skills/skills/get_user_token_for_bitable.py`
